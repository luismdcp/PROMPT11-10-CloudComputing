@model IEnumerable<Note>
          
@if (IsAjax)
{
    Layout = null;
    
    <script src="@Url.Content("~/Scripts/jquery.tablednd.0.7.min.js")" type="text/javascript"></script>
        
    <script type="text/javascript">
        $(document).ready(function () {
            $("#notesTable").tableDnD({
                onDragClass: "myDragClass"
            });

            $("#notesTable tr").hover(function () {
                $(this.cells[0]).addClass('showDragHandle');
            }, function () {
                $(this.cells[0]).removeClass('showDragHandle');
            });
        });
    </script>
}

@{
    ViewBag.Title = "Notes";
}

@Html.ActionLink("Create New", "Create", new { taskListTitle = ViewBag.TaskListTitle })

<br/>
<br/>

@using (@Ajax.BeginForm("SaveNotesOrder", "Notes", new AjaxOptions { HttpMethod = "Post" }))
{
    <table class="table table-bordered table-condensed" id="notesTable">
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>@Ajax.ActionLink("Title", "Index", new { sortOrder = ViewBag.TitleSortParam }, new AjaxOptions { UpdateTargetId = "main" })</th>
                <th>@Ajax.ActionLink("Created At", "Index", new { sortOrder = ViewBag.CreatedSortParam }, new AjaxOptions { UpdateTargetId = "main" })</th>
                <th>Closed?</th>
                <th>&nbsp;</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var note in Model)
            {
                <tr>
                    <td>
                        <input type="hidden" name="orderingIndexes" value="@note.OrderingIndex" />
                        <input type="hidden" name="partitionKeys" value="@note.PartitionKey" />
                        <input type="hidden" name="rowKeys" value="@note.RowKey" />
                        <input type="hidden" name="titles" value="@note.Title" />
                    </td>
                    <td>@note.Title</td>
                    <td>@note.Timestamp.ToShortDateString()</td>
                    <td>@note.IsClosed</td>
                    <td>@Html.ActionLink("Details", "Details", new { taskListTitle = ViewBag.TaskListTitle, noteTitle = note.Title.Replace(' ', '-') }) |
                        @Html.ActionLink("Edit", "Edit", new { taskListTitle = ViewBag.TaskListTitle, noteTitle = note.Title.Replace(' ', '-') }) |
                        @Html.ActionLink("Delete", "Delete", new { taskListTitle = ViewBag.TaskListTitle, noteTitle = note.Title.Replace(' ', '-') }) |
                        @Html.ActionLink("Copy", "Copy", new { noteTitle = note.Title.Replace(' ', '-') }) |
                        @Html.ActionLink("Move", "Move", new { noteTitle = note.Title.Replace(' ', '-') }) |
                        @Html.ActionLink("Users", "AssociateUsersToNote", "Users", new { taskListTitle = ViewBag.TaskListTitle, noteTitle = note.Title }, null)</td>
                </tr>
            }
        </tbody>
    </table>
    
    @Html.Button("submit", "Save order", new { @class = "btn btn-primary" })
}

@Html.RouteLink("Back to List", "Default", new { controller = "TaskLists", action = "Index" })